{% load static %}
{% include 'rh/rh_sidebar.html' %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entretien - {{ candidat.nom }} {{ candidat.prenom }}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { 
    font-family: "Segoe UI", sans-serif;
    background: #f5f5f5;
    color: #333;
    margin: 0;
}
.content {
    margin-left: 260px;
    padding: 2rem;
    max-width: 1200px;
}
.candidate-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    margin-bottom: 2rem;
}
.cv-header {
    display: flex;
    gap: 1.5rem;
    padding: 2rem;
    border-bottom: 1px solid #e5e7eb;
    align-items: center;
}
.candidate-photo {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 1px solid #d1d5db;
}
.candidate-photo-placeholder {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: #f9fafb;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6b7280;
    font-size: 1.5rem;
    font-weight: 500;
    border: 1px solid #d1d5db;
}
.candidate-info { flex: 1; }
.candidate-name { font-size: 1.6rem; font-weight: 600; color: #111827; }
.candidate-title { font-size: 1rem; color: #6b7280; }
.cv-body { padding: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
.cv-section { background: #fff; border: 1px solid #e5e7eb; border-radius: 2px; padding: 1.5rem; }
.cv-section h3 { font-size: 0.9rem; font-weight: 600; text-transform: uppercase; color: #374151; border-bottom: 1px solid #e5e7eb; margin-bottom: 1rem; padding-bottom: 0.5rem; letter-spacing: 0.5px; }
.cv-section p, .cv-section small, .cv-section li { font-size: 0.85rem; color: #4b5563; margin: 0.3rem 0; }
form label { margin-right: 1rem; font-size: 0.9rem; }
input[type="submit"] { margin-top: 1rem; padding: 0.6rem 1.5rem; background: #374151; color: #fff; border: none; border-radius: 3px; cursor: pointer; transition: 0.2s; }
input[type="submit"]:hover { background: #111827; }
ul { padding-left: 1rem; margin: 0; }
@media (max-width: 768px) { .cv-body { grid-template-columns: 1fr; } .cv-header { flex-direction: column; text-align: center; } }
</style>
</head>
<body>
<div class="content">
    {% if candidat %}
    <div class="candidate-card">
        <div class="cv-header">
            {% if cv.photo %}
                <img src="{{ cv.photo.url }}" alt="Photo {{ candidat.nom }}" class="candidate-photo">
            {% else %}
                <div class="candidate-photo-placeholder">{{ candidat.prenom.0 }}{{ candidat.nom.0 }}</div>
            {% endif %}
            <div class="candidate-info">
                <div class="candidate-name">{{ candidat.prenom }} {{ candidat.nom }}</div>
                <div class="candidate-title">{{ cv.titre|default:"CV" }}</div>
                <p>Email: {{ candidat.email }}</p>
                <p>Tél: {{ candidat.telephone|default:"-" }}</p>
                <p>Né(e) le: {{ candidat.date_naissance|date:"d/m/Y"|default:"-" }}</p>
                <p>Adresse: {{ candidat.adresse|default:"-" }}</p>
            </div>
        </div>

        <div class="cv-body">
            <!-- Colonne gauche -->
            <div class="cv-section">
                <h3>Profil</h3>
                <p>{{ cv.resume|default:"-" }}</p>

                <h3>Compétences</h3>
                <ul>
                    {% for c in cv.competences.all %}
                        <li>{{ c.competence }}{% if c.niveau %} ({{ c.niveau }}){% endif %}</li>
                    {% empty %} <li>Aucune compétence renseignée.</li> {% endfor %}
                </ul>

                <h3>Langues</h3>
                <ul>
                    {% for l in cv.langues.all %}
                        <li>{{ l.langue }}{% if l.niveau %} ({{ l.niveau }}){% endif %}</li>
                    {% empty %} <li>Aucune langue renseignée.</li> {% endfor %}
                </ul>
            </div>

            <!-- Colonne droite -->
            <div class="cv-section">
                <h3>Formation</h3>
                <ul>
                    {% for f in cv.formations.all %}
                        <li><strong>{{ f.formation }}</strong> - {{ f.etablissement }} ({{ f.date_debut|default:"?" }} → {{ f.date_fin|default:"?" }})</li>
                    {% empty %} <li>Aucune formation renseignée.</li> {% endfor %}
                </ul>

                <h3>Loisirs</h3>
                <p>
                    {% for lo in cv.loisirs.all %}
                        {{ lo.loisir }}{% if not forloop.last %}, {% endif %}
                    {% empty %} Aucun loisir mentionné. {% endfor %}
                </p>

                <h3>Évaluation entretien</h3>
                <form method="post" action="/rh/entretien/score/">
                    {% csrf_token %}
                    <input type="hidden" name="candidat_id" value="{{ candidat.id }}">
                    <input type="hidden" name="planning_id" value="{{ planning.id }}">
                    <input type="hidden" name="annonce_id" value="{{ planning.id_annonce.id }}">
                    <label><input type="radio" name="score" value="-1"> Mauvais</label>
                    <label><input type="radio" name="score" value="0"> Passable</label>
                    <label><input type="radio" name="score" value="1"> Bien</label>
                    <label><input type="radio" name="score" value="2"> Très Bien</label>
                    <br><input type="submit" value="Valider">
                </form>
            </div>
        </div>
    </div>
    {% endif %}
</div>
</body>
</html>
    